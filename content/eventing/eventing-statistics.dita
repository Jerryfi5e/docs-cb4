<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="eventing_statistics">
  
  <title>
    Eventing Statistics
  </title>
  
  <shortdesc>
    Eventing statistis can be fetched from each eventing node, using the REST API.
  </shortdesc>
  
  <body>
    
    <section>
      
      <title>
        Deploy
      </title>
      
      <p>
        Eventing statistics can be fetched from each eventing node using the REST API bound to localhost. The resulting 
        statistics are local to the node, and suitable for further aggregation across nodes of the cluster. The following
        endpoint could be used to get the statistics:
      </p>
      
      <codeblock outputclass="language-bash">curl http://user:pass@localhost:8096/api/v1/stats?type=full</codeblock>
      
      <p>
        This will return the statistics regarding events processing, events remaining, execution, failure, latency, 
        worker PIDs and seqs processed. This is shown below:
      </p>
      
      <codeblock outputclass="language-javascript">[{
      "function_name": "stock-tracker",
      "event_processing_stats": {
            "DCP_DELETION": 14,
            "DCP_MUTATION": 1,
            "DCP_SNAPSHOT": 15,
            "DCP_STREAMREQ": 1024,
            "DOC_TIMER_EVENTS": 121,
            "CRON_TIMER_EVENTS": 231,
            "TIMERS_IN_PAST": 4
      },
      "events_remaining": {
            "dcp_backlog": 33
      },
      "execution_stats": {
            "agg_queue_size": 2,
            "cron_timer_msg_counter": 0,
            "dcp_delete_msg_counter": 14,
            "dcp_mutation_msg_counter": 1,
            "doc_timer_create_failure": 0,
            "doc_timer_msg_counter": 0,
            "messages_parsed": 67,
            "on_delete_failure": 0,
            "on_delete_success": 14,
            "on_update_failure": 0,
            "on_update_success": 1
      },
      "failure_stats": {
            "bucket_op_exception_count": 0,
            "checkpoint_failure_count": 66,
            "n1ql_op_exception_count": 0,
            "timeout_count": 0
      },
      "latency_stats": {
            "100": 12,
            "1000": 3
      },
      "worker_pids": {
            "worker_h1_0": 28558,
            "worker_h1_1": 28559,
            "worker_h1_2": 28560
      },
      "lcb_exception_stats": {
            "13": 200
      },
      "planner_stats": [{
                  "host_name": "127.0.0.1:9301",
                  "start_vb": 0,
                  "vb_count": 512
            },
            {
                  "host_name": "192.168.0.14:9300",
                  "start_vb": 512,
                  "vb_count": 512
            }
      ],
      "vb_distribution_stats": {
            "127.0.0.1:9300": {
                  "worker_h1_2": "[854-1023]"
            },
            "127.0.0.1:9301": {
                  "worker_h1_0": "[0-170]",
                  "worker_h1_1": "[171-341]",
                  "worker_h1_2": "[342-511]"
            },
            "192.168.0.14:9300": {
                  "worker_h1_0": "[512-682]",
                  "worker_h1_1": "[683-853]"
            }
      },
      "dcp_event_backlog_per_vb": {
            "0": 1,
            ...
      },
      "doc_timer_debug_stats": {
            "0": {},
            ...
      },
      "plasma_stats": {
            "AllocSz": 96,
            ...
      },
      "seqs_processed": {
            "0": 0,
            "1": 0,
            ...
      }
}]
</codeblock>
      
      <p>
        Omitting the parameter `type=full` excludes `dcp_event_backlog_per_vb`, `doc_timer_debug_stats`, 
        `latency_stats`, `plasma_stats` and `seqs_processed` from the response.
      </p>
      
      <codeblock outputclass="language-bourne">curl http://user:pass@localhost:8096/getExecutionStats?name=function_name
curl http://user:pass@localhost:8096/getLatencyStats?name=function_name
curl http://user:pass@localhost:8096/getFailureStats?name=function_name</codeblock>
      
     </section>
   
  </body>
</topic>
